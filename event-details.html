<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>International Relations Timeline</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>International Relations Timeline</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="contribute.html">Contribute</a>
    </nav>
  </header>

  <main>
    <section id="event-details">
      <h2 id="event-headline">Loading...</h2>
      <p><strong>Date:</strong> <span id="event-date"></span></p>
      <p><strong>Region:</strong> <span id="event-region"></span></p>
      <p><strong>Category:</strong> <span id="event-category"></span></p>
      <p><strong>Description:</strong> <span id="event-description"></span></p>
      <div id="event-media"></div>
      <h3>Detailed Summary</h3>
      <p id="event-summary"></p>
      <h3>Sources</h3>
      <ul id="event-sources"></ul>
    </section>
  </main>

  <footer>
    <p>Data from UN, Wikipedia, and contributors. Â© 2025</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const eventId = urlParams.get('id');

      if (!eventId) {
        document.getElementById('event-headline').textContent = 'Error: No event ID provided';
        return;
      }

      try {
        const response = await fetch(`/api/event/${eventId}`);
        if (!response.ok) {
          throw new Error('Event not found');
        }
        const event = await response.json();

        // Populate event details
        document.getElementById('event-headline').textContent = event.text.headline;
        document.getElementById('event-date').textContent = `${event.start_date.year}-${event.start_date.month}-${event.start_date.day}`;
        document.getElementById('event-region').textContent = event.group;
        document.getElementById('event-category').textContent = event.category;
        document.getElementById('event-description').textContent = event.text.text;
        document.getElementById('event-summary').textContent = event.summary || 'No summary available.';

        // Display media if available
        if (event.media && event.media.url) {
          const mediaDiv = document.getElementById('event-media');
          const img = document.createElement('img');
          img.src = event.media.url;
          img.alt = event.text.headline;
          img.style.maxWidth = '100%';
          mediaDiv.appendChild(img);
        }

        // Display sources
        const sourcesList = document.getElementById('event-sources');
        if (event.primarySources && event.primarySources.length > 0) {
          event.primarySources.forEach(source => {
            const li = document.createElement('li');
            if (typeof source === 'string') {
              // Backward compatibility for old string-based sources
              li.innerHTML = `<a href="${source}" target="_blank">${source}</a>`;
            } else {
              // New object-based sources
              li.innerHTML = `
                <a href="${source.url}" target="_blank">${source.title || source.url}</a>
                ${source.summary ? `<p><strong>Summary:</strong> ${source.summary}</p>` : ''}
                ${source.relevance ? `<p><strong>Relevance:</strong> ${source.relevance}</p>` : ''}
              `;
            }
            sourcesList.appendChild(li);
          });
        } else {
          sourcesList.innerHTML = '<li>No sources available.</li>';
        }
      } catch (error) {
        document.getElementById('event-headline').textContent = 'Error loading event';
        console.error('Error fetching event:', error);
      }
    });
  </script>
</body>
</html>